import{d as j,r as b,c as Y,w as l,b as B,o as C,e,u as $,f as x,g as q,h as ne,n as re,i as O,F as z,a as p,j as ie,B as H,t as D,k as de,l as ce,m as me,C as pe,R as _e,T as ve,p as fe}from"./index-DSC3Ms3s.js";import{C as ge}from"./index-C7m1n5xG.js";import{S as W,O as Z}from"./index-Dx-HpozK.js";import{M as R,I as F}from"./index-Cl0MKicR.js";import"./index-DbxXUXlj.js";import{T as be}from"./index-D5xu3zuE.js";import{I as ye}from"./index-CwNc2FHS.js";import{S as X}from"./index-DYJE_-5E.js";import{M as ee,D as Ve}from"./index-C9PAZute.js";import{F as G,a as J}from"./index-DP1lsub_.js";import{d as Q}from"./date-BOtkChFv.js";import{l as le,P as Ce,U as ae}from"./lodash-CrBx8sQR.js";import"./keyboard-DIWrcbmK.js";const Ae={key:0,class:"arco-upload-list-picture custom-upload-avatar"},Ue=["src"],he={class:"arco-upload-list-picture-mask"},Se={key:1,class:"arco-upload-picture-card"},Pe={class:"arco-upload-picture-card-text"},ke=x("div",{style:{"margin-top":"10px","font-weight":"600"}},"Upload",-1),Ne=j({__name:"UserAdd",props:{visible:{type:Boolean}},emits:["update:visible"],setup(K,{emit:L}){const v=[{title:"管理员",value:"admin"},{title:"用户",value:"user"}],y=v.map(m=>m.title),P=b({userName:"",userAccount:"",userProfile:"",userAvatar:null,userRole:""}),r=b(P.value),o=L,k={userName:[{required:!0,message:"昵称是必填项"}],userAccount:[{required:!0,message:"账号是必填项"}],userAvatar:[{required:!0,type:"object",message:"头像是必填项"}],userRole:[{required:!0,message:"角色必须是用户或管理员",validator(m){return y.includes(m)}}]},N=()=>{o("update:visible",!1)},i=b(),T=le.debounce((m,d)=>{console.log("当前文件：",d),i.value=d,r.value.userAvatar=d.file},200),A=m=>{i.value=m},h=async()=>{console.log("当前提交表单：",r);const m=await ie(r.value);m.data.code===0?(R.success("添加成功"),S(),N()):R.error("添加失败"),console.log("提交结果：",m)},S=()=>{r.value=P.value,i.value=null};return(m,d)=>{const s=F,a=G,t=B("IconEdit"),u=Ce,g=B("IconPlus"),f=ae,V=Z,E=W,U=H,I=X,M=J,w=ee;return C(),Y(w,{footer:!1,visible:m.visible,title:"添加用户",onCancel:N},{default:l(()=>[e(M,{model:r.value,rules:k,onSubmit:h},{default:l(()=>[e(a,{field:"userName",label:"昵称：","validate-trigger":"blur"},{default:l(()=>[e(s,{modelValue:r.value.userName,"onUpdate:modelValue":d[0]||(d[0]=_=>r.value.userName=_),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),e(a,{field:"userAccount",label:"账号：","validate-trigger":"blur"},{default:l(()=>[e(s,{modelValue:r.value.userAccount,"onUpdate:modelValue":d[1]||(d[1]=_=>r.value.userAccount=_),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1}),e(a,{field:"userProfile",label:"简介：","validate-trigger":"blur"},{default:l(()=>[e(s,{modelValue:r.value.userAccount,"onUpdate:modelValue":d[2]||(d[2]=_=>r.value.userAccount=_),placeholder:"请输入用户账简介"},null,8,["modelValue"])]),_:1}),e(a,{field:"userAvatar",label:"头像："},{default:l(()=>[e(f,{"auto-upload":!1,fileList:i.value?[i.value]:[],draggable:"","show-file-list":"",onChange:$(T),onProgress:A},{"upload-button":l(()=>[x("div",{class:re(`arco-upload-list-item${i.value&&i.value.status==="error"?" arco-upload-list-item-error":""}`)},[i.value&&i.value.url?(C(),q("div",Ae,[x("img",{src:i.value.url},null,8,Ue),x("div",he,[e(t)]),i.value.status==="uploading"&&i.value.percent<100?(C(),Y(u,{key:0,percent:i.value.percent,style:{position:"absolute",left:"50%",top:"50%",transform:"translateX(-50%) translateY(-50%)"},size:"mini",type:"circle"},null,8,["percent"])):ne("",!0)])):(C(),q("div",Se,[x("div",Pe,[e(g),ke])]))],2)]),_:1},8,["fileList","onChange"])]),_:1}),e(a,{field:"userRole",label:"角色：","validate-trigger":"blur"},{default:l(()=>[e(E,{modelValue:r.value.userRole,"onUpdate:modelValue":d[3]||(d[3]=_=>r.value.userRole=_),placeholder:"请输入选择用户角色"},{default:l(()=>[(C(),q(z,null,O(v,_=>e(V,{key:_.value,value:_.value},{default:l(()=>[p(D(_.title),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(a,null,{default:l(()=>[e(I,null,{default:l(()=>[e(U,{onClick:N},{default:l(()=>[p("取消")]),_:1}),e(U,{type:"primary",onClick:h},{default:l(()=>[p("添加")]),_:1}),e(U,{onClick:S},{default:l(()=>[p("重置")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),Te=j({__name:"UserEdit",props:{visible:{type:Boolean},user:{}},emits:["update:visible"],setup(K,{emit:L}){var s,a;const v=[{title:"管理员",value:"admin"},{title:"用户",value:"user"}],y=[{title:"启用",value:1},{title:"禁用",value:0}],P=v.map(t=>t.title),r=y.map(t=>t.title),o=b({...user,newAvatar:null}),k=[{uid:"-2",name:(a=user.userAvatar)==null?void 0:a.split("/")[((s=user.userAvatar)==null?void 0:s.split("/").length)-1],url:user.userAvatar}],N=L,i={userName:[{required:!0,message:"昵称是必填项"}],userAccount:[{required:!0,message:"账号是必填项"}],userAvatar:[{required:!0,type:"object",message:"头像是必填项"}],userRole:[{required:!0,message:"角色必须是用户或管理员",validator(t){return P.includes(t)}}],userStatus:[{required:!0,message:"用户状态必须是禁用或启用",validator(t){return r.includes(t)}}]},T=()=>{N("update:visible",!1)},A=b(),h=le.debounce((t,u)=>{console.log("当前文件：",u),A.value=u,o.value.newAvatar=u.file},200),S=t=>{A.value=t},m=async()=>{console.log("当前提交表单：",o);const t=await de(o.value);t.data.code===0?(R.success("修改成功"),d(),T()):R.error("修改失败"),console.log("提交结果：",t)},d=()=>{o.value=user,A.value=null};return(t,u)=>{const g=F,f=G,V=ae,E=Z,U=W,I=H,M=X,w=J,_=ee;return C(),Y(_,{footer:!1,visible:t.visible,title:"修改用户",onCancel:T},{default:l(()=>[e(w,{model:o.value,rules:i,onSubmit:m},{default:l(()=>[e(f,{field:"id",label:"编号："},{default:l(()=>[e(g,{modelValue:o.value.id,"onUpdate:modelValue":u[0]||(u[0]=n=>o.value.id=n),value:t.user.id,disabled:""},null,8,["modelValue","value"])]),_:1}),e(f,{field:"userName",label:"昵称：","validate-trigger":"blur"},{default:l(()=>[e(g,{modelValue:o.value.userName,"onUpdate:modelValue":u[1]||(u[1]=n=>o.value.userName=n),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),e(f,{field:"userProfile",label:"简介：","validate-trigger":"blur"},{default:l(()=>[e(g,{modelValue:o.value.userProfile,"onUpdate:modelValue":u[2]||(u[2]=n=>o.value.userProfile=n),placeholder:"请输入用户账简介"},null,8,["modelValue"])]),_:1}),e(f,{field:"userAvatar",label:"头像："},{default:l(()=>[e(V,{"auto-upload":!1,"default-file-list":k,limit:1,draggable:"","image-preview":"","list-type":"picture-card","show-file-list":"",onChange:$(h),onProgress:S},null,8,["onChange"])]),_:1}),e(f,{field:"userRole",label:"角色：","validate-trigger":"blur"},{default:l(()=>[e(U,{modelValue:o.value.userRole,"onUpdate:modelValue":u[3]||(u[3]=n=>o.value.userRole=n),placeholder:"请输入选择用户角色"},{default:l(()=>[(C(),q(z,null,O(v,n=>e(E,{key:n.value,value:n.value},{default:l(()=>[p(D(n.title),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(f,{field:"userStatus",label:"状态：","validate-trigger":"blur"},{default:l(()=>[e(U,{modelValue:o.value.userStatus,"onUpdate:modelValue":u[4]||(u[4]=n=>o.value.userStatus=n),placeholder:"请输入选择用户状态"},{default:l(()=>[(C(),q(z,null,O(y,n=>e(E,{key:n.value,value:n.value},{default:l(()=>[p(D(n.title),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(M,null,{default:l(()=>[e(I,{onClick:T},{default:l(()=>[p("取消")]),_:1}),e(I,{type:"primary",onClick:m},{default:l(()=>[p("修改")]),_:1}),e(I,{onClick:d},{default:l(()=>[p("重置")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),Ie={id:"adminUserPage"},je=j({__name:"AdminUserPage",setup(K){const L={current:1,pageSize:7},v=b({}),y=b({...L}),P=b([]),r=b(0),o=async()=>{var a,t;const s=await fe(y.value);s.data.code===0?(P.value=((a=s.data.data)==null?void 0:a.records)||[],r.value=((t=s.data.data)==null?void 0:t.total)||0):R.error("获取用户数据失败，"+s.data.message)},k=()=>{y.value={...L,...v.value}},N=()=>{v.value={}},i=s=>{y.value={...y.value,current:s}};ce(()=>{o()});const T=async s=>{if(!s.id)return;(await me({id:s.id})).data.data?(o(),R.success("删除成功")):R.error("删除数据失败")},A=b(!1),h=b(!1),S=b({}),m=s=>{h.value=!0,S.value=s},d=[{title:"id",dataIndex:"id",ellipsis:!0,tooltip:!0,width:60},{title:"账号",dataIndex:"userAccount"},{title:"用户名",dataIndex:"userName"},{title:"用户头像",dataIndex:"userAvatar",slotName:"userAvatar"},{title:"用户简介",dataIndex:"userProfile",ellipsis:!0,tooltip:!0},{title:"权限",dataIndex:"userRole"},{title:"创建时间",dataIndex:"createTime",slotName:"createTime"},{title:"更新时间",dataIndex:"updateTime",slotName:"updateTime"},{title:"操作",slotName:"optional"}];return(s,a)=>{const t=F,u=G,g=pe,f=_e,V=H,E=J,U=Ve,I=B("icon-search"),M=B("icon-refresh"),w=X,_=B("icon-plus"),n=ve,te=ye,oe=be,se=ge;return C(),q(z,null,[x("div",Ie,[e(se,{title:"用户列表"},{default:l(()=>[e(f,null,{default:l(()=>[e(g,{flex:2},{default:l(()=>[e(E,{"label-col-props":{span:5},model:v.value,"wrapper-col-props":{span:18},"label-align":"left",onSubmit:k},{default:l(()=>[e(f,{gutter:16},{default:l(()=>[e(g,{span:8},{default:l(()=>[e(u,{field:"userName",label:"用户名"},{default:l(()=>[e(t,{modelValue:v.value.userName,"onUpdate:modelValue":a[0]||(a[0]=c=>v.value.userName=c),"allow-clear":"",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{span:8},{default:l(()=>[e(u,{field:"userProfile",label:"用户简介"},{default:l(()=>[e(t,{modelValue:v.value.userProfile,"onUpdate:modelValue":a[1]||(a[1]=c=>v.value.userProfile=c),"allow-clear":"",placeholder:"请输入用户简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{"html-type":"submit",style:{display:"none"}})]),_:1},8,["model"])]),_:1}),e(U,{direction:"vertical",style:{height:"42px"}}),e(g,{flex:"86px",style:{"text-align":"right"}},{default:l(()=>[e(w,{size:18,direction:"horizontal"},{default:l(()=>[e(V,{type:"primary",onClick:k},{icon:l(()=>[e(I)]),default:l(()=>[p(" 查询 ")]),_:1}),e(V,{onClick:N},{icon:l(()=>[e(M)]),default:l(()=>[p(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1}),e(U,{style:{"margin-top":"0"}}),e(f,{style:{"margin-bottom":"16px"}},{default:l(()=>[e(g,{span:12},{default:l(()=>[e(w,null,{default:l(()=>[e(V,{type:"primary",onClick:a[2]||(a[2]=c=>A.value=!0)},{icon:l(()=>[e(_)]),default:l(()=>[p(" 新建 ")]),_:1})]),_:1})]),_:1}),e(g,{span:12,style:{display:"flex","align-items":"center","justify-content":"end"}},{default:l(()=>[e(n,{content:"刷新"},{default:l(()=>[x("div",{class:"action-icon",onClick:k},[e(M,{size:"18"})])]),_:1})]),_:1})]),_:1}),e(oe,{columns:d,data:P.value,pagination:{showTotal:!0,pageSize:y.value.pageSize,current:y.value.current,total:r.value},onPageChange:i},{createTime:l(({record:c})=>[p(D($(Q)(c.createTime).format("YYYY-MM-DD HH:mm:ss")),1)]),updateTime:l(({record:c})=>[p(D($(Q)(c.updateTime).format("YYYY-MM-DD HH:mm:ss")),1)]),userAvatar:l(({record:c})=>[e(te,{src:c.userAvatar,width:"64"},null,8,["src"])]),optional:l(({record:c})=>[e(w,null,{default:l(()=>[e(V,{status:"danger",onClick:ue=>T(c)},{default:l(()=>[p("删除")]),_:2},1032,["onClick"]),e(V,{onClick:ue=>m(c)},{default:l(()=>[p("编辑")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","pagination"])]),_:1})]),e(Ne,{visible:A.value,"onUpdate:visible":a[3]||(a[3]=c=>A.value=c)},null,8,["visible"]),(C(),Y(Te,{key:S.value.id,visible:h.value,"onUpdate:visible":a[4]||(a[4]=c=>h.value=c),user:S.value},null,8,["visible","user"]))],64)}}});export{je as default};
